language: python
cache:
  pip: true
  directories:
    - ".chalice/venv"
python:
  - 3.6
dist: trusty
addons:
  apt:
    packages:
      - jq
      - moreutils
      - gettext
install:
  - pip install -r requirements.txt
  - pip install -r requirements-dev.txt
before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
script:
  - source config/environment
  - make test
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
after_success:
  - bash <(curl -s https://codecov.io/bash)
deploy:
  # deploy master branch to the dev environment
  - provider: script
    script: scripts/deploy.sh dev
    skip_cleanup: true
    on:
      branch: master
      python: 3.6
  # deploy staging branch to staging environment
  - provider: script
    script: scripts/deploy.sh staging
    skip_cleanup: true
    on:
      branch: staging
      python: 3.6
env:
  global:
    - CC_TEST_REPORTER_ID=8673a342bc2822cbdfe151982a7e72743f44fecd030867754d8d34ebf845b130
    # AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
    - secure: VgZRcYV3jSpel8nicD1Pr9QpbeYQcD1fUjct6g2Ke0YGnLRXmiFffAjgSH71UK1eddN9PT8K0LLfSD0+rr/Dl1o9TdMi2XFWNuBGhr8ger/oRUQuy1HAZQ5ivhzqZqIaCZ4v+DdK/OXGjf36IgPGoZmtAUXfv6HzQ0+276kUTHFaqXCyApn1+5Ni2dhzCQF4JnbAarvpMTdS7harcfkL4ALNsgXDxSeIuYa/N6jkCTQbECYR+168jbGKnIyrPVAplOm7gI+tGrgKhTd3S3PEJR1H9QH31C1/iI9eOiSe71yVDyBWcdDBQHIbn5Ig1bi/9XAc/3vCk0nhDskQ0sLvvsmyK+q8cFCYxmXexcqioPjG6e48mv/Hr/xZMrGPDpr0IGShmpa8ZqMWH/KUfD0MGGAFvSwZU8nR3xoMSem/Ewnm1On8uFb2WyESTgwcUPVKUd4JkTyS+ZbDv2c2/F46ZbwQIkMA6zRThubtZdzzNzTMTY2IvY/anFdxzGp2g0sn6n3/4Vg34lTiIzQePiYeVb0OAEMeOHa0xFislQS8bVU42QRwCaQ+43/VGlhsaJO1/sEoga5rkRVgld58ZrVwYNHBR1fWfa8uOn6d1VWtCUP95pneNvEPe8kBCqW8CMgW/Riiio0fujnnTaXPA42TPchbKFtPEULe8265T7dP5zw=
    - secure: pyrI2UGM22pbBwbA+HrGyF1IMtU6H2tYmrZ+udZCIBGloGz+qtyjgLpJgFRwoTeksdfPFl4XDckEkQGILkKE6gnkBOBhL59qHdcJDV3T8kH5pBMxpKgUzSo3Tu7mjR8GxJOYK+sZa9oM8T8eMC87RdUdpjWRJB/XfJfQpPO1WE6FJNbQzaQvpolhA45DbrFXeLu7oiMAuCI3sY5c8esKPtUtbNtVuVfIY6NwXGdCYonEHOSsaQE7eYnKSMOMts/5pnw74QXVJHJYF7j6AkzXme49q3zjjtA/MEW2kuMSUfK+pSgv0EJD02V60+QWHFlNvHdjfMDQF5Vi4hI8Kqo3I0TQkErHA/gbtYEEjEjC0qF5rrvGnMcRlvbYlS/7Vks9iPrBXOiDbaLt5CpvS8cu0GKJ1G7UPY69iCFIoPD7hrYzZwZQeix69ZvNhT/WFOoNGm0u4x4lTROQJHyakej06P7jEmaYkA1Cu4vHzO/u+TAljHnSXTggJCizG4dgY19KLEo4zzsUha8dWm3H75dIpCYNoKLmwCaKqZWsdBdrmL+eRDITf8QDIuLUnFxp4nsIagGG8fJX9szaqwDkb9/xhPSDA255jnY+FPdJ63MGa5vmt2d84M5u0VdbdOEnhZjJvsHZdLeAlB0TJkHq06wWG+lS5/zc3wd4xaBBLz41Gvo=
    # enc_password
    - secure: AIB4I+rWirx+fIheq0lHno8JFhWSmjg5p+/CyIK9FoD2WBb18vPaEMkuDxblUox9sUDjVAaxFNs1iTIOdxchflA9oW5LQttJKJWdjlMKW1tdJ9ipUdxZ6qnCP84OEL8fJMT4rvrzA17DTOWzXCDoJzNyab6O6TXb3WGYf57OyAkGdZ6GUJmeQmSbLmXLRYpWru0uam8Q9gtIHuFH151sOWWWNLTLFM8idxp4LIWVO1u8vADIhxd9i1HkOj4lYrrNTsHAcilVR1yMj3ovaJOTDNk1D6067ZI3rzb3lUOqZIIz1loNUwz6zqp8isAZ1Dnzz/+I5Q9uKoYIrnYX245L8I6vU71EiSTbgsHwdLn5ICLpyrBDr7YVBg68lrqzEzQWKWkBC0jeGGjCwdZitb+o4MmlG3f7W9g5a/OLelTdiDcgM+3nj2QgApGnAZle7kJW90jEC3aroNbSuHnffX6tmwdil4m5eyqqAWwwOQ3OpVR4yM4vxeaL5xnCVwJ4N3ZYTzvDlaUURqoqKOsCVlGBETS3XdOqg17MFBk+H5GsATOno1rMHo7ztBIvcqzyIj4RvxFTFrMehFnJ9lLUlpo7R0I3chXNzijLWbrkKcFJB7+Ujo/bTBH5VsvShjpAkAWlKx63Js97+bN8prslA3uJ0y4He2nKvIQmrItgztreQgs=
    # GITHUB_ACCESS_TOKEN
    - secure: VRexoV6YRb9FF190MSBufaft67Jfb55AM/2iE8p/P75qMvQ7TXz4oeNsbzjyKz3n55YxAct7mz14vHapsqrgU4ChXs607BHCG8GUiwIWGX2g0wRdkSuSAqk/6fj6RwMBPfjuuxLjUyu11Y6n6j/kJaM3rGC6P94Bdk0FIwuQaGCpxkv6ltoD2eNwQ5JtQ9qkkV8xLnpWvEauK7IX/9oqmHK1gait4btHxQVz+zhmokNqTcLE+GB8XE1qWFbIJGm7qqMWq95BEpHExFdwjZairhOKsh/f/PIqjiam+7NroS8pjsfUsZiANqQZcpJBxeTH7Z27dPxf2EIPnUulDpMcef03VM8OaZQckMDh4ebkKRYL+xTuO7iCgV7XHSVAFlVGycOSoDb2ZPHqMjVwwJsT+XtVaqPT+cUCCHaphjJ4Ev+4DattGgYDnx5Ame1W/MaIRCq0lU7gAGWh9WQ1EYGggtuX+PVtHfrZ+P88KP6q7HVeVhu2WRLbeL91Ql87pX0sCsUHOjxUTF1h3Wq32ub+gY5iH3x1UIZJA2+forIkK73whLgsEFEAZNBhEKt6vvXfolXZw53GBHK2qKn/9Uag4Wg0lPmWtvtnAsZgb6LmyYlm1l/QJRQHsQQt+GQKIl52/+dYacJFS5D9eAGFUMHXIkQYZPaW8RxPMAgpfkOiqZY=
